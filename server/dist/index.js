"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const ws_1 = __importDefault(require("ws"));
const express_1 = __importDefault(require("express"));
const path_1 = require("path");
const player_1 = __importDefault(require("./modules/player"));
const math_1 = require("./modules/math");
const socket_1 = require("./modules/socket");
const app = (0, express_1.default)();
app.use(express_1.default.static((0, path_1.join)(__dirname, "../", "../", "public")));
console.log(__dirname);
const server = app.listen(6969, '0.0.0.0', () => {
    console.log("Ready!");
});
const wss = new ws_1.default.Server({ server });
const players = [];
const blobs = [];
wss.on('connection', (socket, req) => {
    const player = new player_1.default(socket, "Unnamed Player", new math_1.Vec2((0, math_1.randInt)(1000, 1200), (0, math_1.randInt)(1000, 1200)));
    players.push(player);
    console.log(`${player.name} joined!`);
});
// Timing things; nightmare! YEET
setInterval(() => {
    for (let player of players) {
        player.velocity = player.direction;
        player.pos = player.pos.add(player.velocity);
        (0, socket_1.playerUpdate)(player.socket, [player], true);
        for (let player2 of players) {
            if (player2.pos.distance(player.pos) > 1000) {
                (0, socket_1.playerUpdate)(player2.socket, [player]);
            }
        }
    }
}, 1000 / 20);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSw0Q0FBb0I7QUFDcEIsc0RBQThCO0FBQzlCLCtCQUEyQjtBQUMzQiw4REFBc0M7QUFDdEMseUNBQStDO0FBQy9DLDZDQUFnRDtBQUdoRCxNQUFNLEdBQUcsR0FBRyxJQUFBLGlCQUFPLEdBQUUsQ0FBQztBQUV0QixHQUFHLENBQUMsR0FBRyxDQUFDLGlCQUFPLENBQUMsTUFBTSxDQUFDLElBQUEsV0FBSSxFQUFDLFNBQVMsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUVqRSxPQUFPLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBRXZCLE1BQU0sTUFBTSxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLFNBQVMsRUFBRSxHQUFHLEVBQUU7SUFDNUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUMxQixDQUFDLENBQUMsQ0FBQztBQUVILE1BQU0sR0FBRyxHQUFHLElBQUksWUFBRSxDQUFDLE1BQU0sQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7QUFFdEMsTUFBTSxPQUFPLEdBQWEsRUFBRSxDQUFDO0FBQzdCLE1BQU0sS0FBSyxHQUFXLEVBQUUsQ0FBQztBQUV6QixHQUFHLENBQUMsRUFBRSxDQUFDLFlBQVksRUFBRSxDQUFDLE1BQU0sRUFBRSxHQUFHLEVBQUUsRUFBRTtJQUNqQyxNQUFNLE1BQU0sR0FBRyxJQUFJLGdCQUFNLENBQUMsTUFBTSxFQUFFLGdCQUFnQixFQUFFLElBQUksV0FBSSxDQUFDLElBQUEsY0FBTyxFQUFDLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxJQUFBLGNBQU8sRUFBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3hHLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDckIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxJQUFJLFVBQVUsQ0FBQyxDQUFDO0FBQzFDLENBQUMsQ0FBQyxDQUFDO0FBRUgsaUNBQWlDO0FBQ2pDLFdBQVcsQ0FBQyxHQUFHLEVBQUU7SUFDYixLQUFLLElBQUksTUFBTSxJQUFJLE9BQU8sRUFBRTtRQUN4QixNQUFNLENBQUMsUUFBUSxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUM7UUFDbkMsTUFBTSxDQUFDLEdBQUcsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUM7UUFFN0MsSUFBQSxxQkFBWSxFQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxNQUFNLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUU1QyxLQUFLLElBQUksT0FBTyxJQUFJLE9BQU8sRUFBRTtZQUN6QixJQUFJLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLEVBQUU7Z0JBQ3pDLElBQUEscUJBQVksRUFBQyxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQzthQUMxQztTQUNKO0tBQ0o7QUFDTCxDQUFDLEVBQUUsSUFBSSxHQUFHLEVBQUUsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHdzIGZyb20gJ3dzJztcbmltcG9ydCBleHByZXNzIGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IHsgam9pbiB9IGZyb20gJ3BhdGgnXG5pbXBvcnQgUGxheWVyIGZyb20gJy4vbW9kdWxlcy9wbGF5ZXInO1xuaW1wb3J0IHsgcmFuZEludCwgVmVjMiB9IGZyb20gJy4vbW9kdWxlcy9tYXRoJztcbmltcG9ydCB7IHBsYXllclVwZGF0ZSB9IGZyb20gJy4vbW9kdWxlcy9zb2NrZXQnO1xuaW1wb3J0IHNldHRpbmdzIGZyb20gJy4vbW9kdWxlcy9zZXR0aW5ncyc7XG5cbmNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcblxuYXBwLnVzZShleHByZXNzLnN0YXRpYyhqb2luKF9fZGlybmFtZSwgXCIuLi9cIiwgXCIuLi9cIiwgXCJwdWJsaWNcIikpKTtcblxuY29uc29sZS5sb2coX19kaXJuYW1lKTtcblxuY29uc3Qgc2VydmVyID0gYXBwLmxpc3Rlbig2OTY5LCAnMC4wLjAuMCcsICgpID0+IHsgLy8gcmV0dXJucyBhIHNlcnZlclxuICAgIGNvbnNvbGUubG9nKFwiUmVhZHkhXCIpO1xufSk7XG5cbmNvbnN0IHdzcyA9IG5ldyB3cy5TZXJ2ZXIoeyBzZXJ2ZXIgfSk7XG5cbmNvbnN0IHBsYXllcnM6IFBsYXllcltdID0gW107XG5jb25zdCBibG9iczogQmxvYltdID0gW107XG5cbndzcy5vbignY29ubmVjdGlvbicsIChzb2NrZXQsIHJlcSkgPT4ge1xuICAgIGNvbnN0IHBsYXllciA9IG5ldyBQbGF5ZXIoc29ja2V0LCBcIlVubmFtZWQgUGxheWVyXCIsIG5ldyBWZWMyKHJhbmRJbnQoMTAwMCwgMTIwMCksIHJhbmRJbnQoMTAwMCwgMTIwMCkpKTtcbiAgICBwbGF5ZXJzLnB1c2gocGxheWVyKTtcbiAgICBjb25zb2xlLmxvZyhgJHtwbGF5ZXIubmFtZX0gam9pbmVkIWApO1xufSk7XG5cbi8vIFRpbWluZyB0aGluZ3M7IG5pZ2h0bWFyZSEgWUVFVFxuc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgIGZvciAobGV0IHBsYXllciBvZiBwbGF5ZXJzKSB7XG4gICAgICAgIHBsYXllci52ZWxvY2l0eSA9IHBsYXllci5kaXJlY3Rpb247XG4gICAgICAgIHBsYXllci5wb3MgPSBwbGF5ZXIucG9zLmFkZChwbGF5ZXIudmVsb2NpdHkpO1xuXG4gICAgICAgIHBsYXllclVwZGF0ZShwbGF5ZXIuc29ja2V0LCBbcGxheWVyXSwgdHJ1ZSk7XG4gICAgICAgIFxuICAgICAgICBmb3IgKGxldCBwbGF5ZXIyIG9mIHBsYXllcnMpIHtcbiAgICAgICAgICAgIGlmIChwbGF5ZXIyLnBvcy5kaXN0YW5jZShwbGF5ZXIucG9zKSA+IDEwMDApIHtcbiAgICAgICAgICAgICAgICBwbGF5ZXJVcGRhdGUocGxheWVyMi5zb2NrZXQsIFtwbGF5ZXJdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn0sIDEwMDAgLyAyMCk7XG4iXX0=