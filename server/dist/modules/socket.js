"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.playerUpdate = exports.blobUpdate = exports.foodUpdate = void 0;
/*
------------------------------------
Server to client updates
    First byte of message:
    0 = blob updates
------------------------------------

------------------------------------
Server to client blob updates
    Second byte of message:
    0 = blob
    1 = food
    2 = player
    3 = virus
------------------------------------

------------------------------------
Server to client blob blob updates
    Third byte of message: //11
    x, y, dX, dY, color, radius, mass
------------------------------------

------------------------------------
Server to client blob food updates
    Third byte of message:
    x, y
------------------------------------

------------------------------------
Server to client blob player updates
    Third byte of message:
    x, y, dX, dY, color, radius, mass, name
------------------------------------

------------------------------------
Server to client blob virus updates
    Third byte of message:
    x, y, radius
------------------------------------

------------------------------------
Client to server updates
    First byte of message:
    0 = Move direction update
    1 = Eject mass update
    2 = Split update
------------------------------------

------------------------------------
Client to server move direction update
    Second byte of message:
    direction x y
------------------------------------
*/
const foodUpdate = (socket, foods) => {
    const message = new ArrayBuffer(foods.length * 4);
    const dv = new DataView(message);
    for (let i = 0; i < foods.length; i++) {
        const food = foods[i];
        console.log(food.pos.x, food.pos.y);
        dv.setUint16(i * 4, food.pos.x);
        dv.setUint16(i * 4 + 2, food.pos.y);
    }
    socket.send(message);
};
exports.foodUpdate = foodUpdate;
const blobUpdate = (socket, blobs) => {
    const message = new ArrayBuffer(blobs.length * 15);
    const dv = new DataView(message);
    for (let i = 0; i < blobs.length; i++) {
        const blob = blobs[i];
        dv.setUint16(i * 15, blob.pos.x);
        dv.setUint16(i * 15 + 2, blob.pos.y);
        dv.setUint16(i * 15 + 4, blob.velocity.x);
        dv.setUint16(i * 15 + 6, blob.velocity.y);
        dv.setUint8(i * 15 + 8, blob.color.r);
        dv.setUint8(i * 15 + 9, blob.color.g);
        dv.setUint8(i * 15 + 10, blob.color.b);
        dv.setUint16(i * 15 + 11, blob.radius);
        dv.setUint16(i * 15 + 13, blob.mass);
    }
    socket.send(message);
};
exports.blobUpdate = blobUpdate;
const playerUpdate = (socket, players, isSelf = false) => {
    const message = new ArrayBuffer(players.length * 16);
    const dv = new DataView(message);
    for (let i = 0; i < players.length; i++) {
        const player = players[i];
        dv.setUint16(i * 16, player.pos.x);
        dv.setUint16(i * 16 + 2, player.pos.y);
        dv.setUint16(i * 16 + 4, player.velocity.x);
        dv.setUint16(i * 16 + 6, player.velocity.y);
        dv.setUint8(i * 16 + 8, 255);
        dv.setUint8(i * 16 + 9, 0);
        dv.setUint8(i * 16 + 10, 0);
        dv.setUint16(i * 16 + 11, player.radius);
        dv.setUint16(i * 16 + 13, player.mass);
        dv.setUint8(i * 16 + 15, (isSelf ? 1 : 0));
    }
    socket.send(message);
};
exports.playerUpdate = playerUpdate;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29ja2V0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL21vZHVsZXMvc29ja2V0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUtBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztFQXFERTtBQUVLLE1BQU0sVUFBVSxHQUFHLENBQUMsTUFBVSxFQUFFLEtBQWEsRUFBUSxFQUFFO0lBQzFELE1BQU0sT0FBTyxHQUFHLElBQUksV0FBVyxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUMsQ0FBQyxDQUFDLENBQUM7SUFDaEQsTUFBTSxFQUFFLEdBQUcsSUFBSSxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUM7SUFFakMsS0FBSSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7UUFDbEMsTUFBTSxJQUFJLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRXRCLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUVwQyxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUMsR0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM5QixFQUFFLENBQUMsU0FBUyxDQUFDLENBQUMsR0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7S0FDckM7SUFFRCxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQ3pCLENBQUMsQ0FBQTtBQWRZLFFBQUEsVUFBVSxjQWN0QjtBQUVNLE1BQU0sVUFBVSxHQUFHLENBQUMsTUFBVSxFQUFFLEtBQWEsRUFBUSxFQUFFO0lBQzFELE1BQU0sT0FBTyxHQUFHLElBQUksV0FBVyxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUMsRUFBRSxDQUFDLENBQUM7SUFDakQsTUFBTSxFQUFFLEdBQUcsSUFBSSxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUM7SUFFakMsS0FBSSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7UUFDbEMsTUFBTSxJQUFJLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRXRCLEVBQUUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxHQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQy9CLEVBQUUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxHQUFDLEVBQUUsR0FBRyxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUVuQyxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUMsR0FBQyxFQUFFLEdBQUcsQ0FBQyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDeEMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEdBQUMsRUFBRSxHQUFHLENBQUMsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRXhDLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFDLEVBQUUsR0FBRyxDQUFDLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNwQyxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBQyxFQUFFLEdBQUcsQ0FBQyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDcEMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUMsRUFBRSxHQUFHLEVBQUUsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRXJDLEVBQUUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxHQUFDLEVBQUUsR0FBRyxFQUFFLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3JDLEVBQUUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxHQUFDLEVBQUUsR0FBRyxFQUFFLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0tBQ3RDO0lBRUQsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUN6QixDQUFDLENBQUE7QUF0QlksUUFBQSxVQUFVLGNBc0J0QjtBQUVNLE1BQU0sWUFBWSxHQUFHLENBQUMsTUFBVSxFQUFFLE9BQWlCLEVBQUUsU0FBa0IsS0FBSyxFQUFRLEVBQUU7SUFDekYsTUFBTSxPQUFPLEdBQUcsSUFBSSxXQUFXLENBQUMsT0FBTyxDQUFDLE1BQU0sR0FBQyxFQUFFLENBQUMsQ0FBQztJQUNuRCxNQUFNLEVBQUUsR0FBRyxJQUFJLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUVqQyxLQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtRQUNwQyxNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFMUIsRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEdBQUMsRUFBRSxFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDakMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEdBQUMsRUFBRSxHQUFHLENBQUMsRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRXJDLEVBQUUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxHQUFDLEVBQUUsR0FBRyxDQUFDLEVBQUUsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMxQyxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUMsR0FBQyxFQUFFLEdBQUcsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFMUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUMsRUFBRSxHQUFHLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUMzQixFQUFFLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBQyxFQUFFLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3pCLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFDLEVBQUUsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFFMUIsRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEdBQUMsRUFBRSxHQUFHLEVBQUUsRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDdkMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEdBQUMsRUFBRSxHQUFHLEVBQUUsRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFckMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUMsRUFBRSxHQUFHLEVBQUUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0tBQzVDO0lBRUQsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUN6QixDQUFDLENBQUE7QUF4QlksUUFBQSxZQUFZLGdCQXdCeEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRm9vZCBmcm9tICcuL2Zvb2QnO1xuaW1wb3J0IEJsb2IgZnJvbSAnLi9ibG9iJztcbmltcG9ydCBQbGF5ZXIgZnJvbSAnLi9wbGF5ZXInO1xuaW1wb3J0IHdzIGZyb20gJ3dzJztcblxuLypcbi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuU2VydmVyIHRvIGNsaWVudCB1cGRhdGVzXG4gICAgRmlyc3QgYnl0ZSBvZiBtZXNzYWdlOlxuICAgIDAgPSBibG9iIHVwZGF0ZXNcbi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblNlcnZlciB0byBjbGllbnQgYmxvYiB1cGRhdGVzXG4gICAgU2Vjb25kIGJ5dGUgb2YgbWVzc2FnZTpcbiAgICAwID0gYmxvYlxuICAgIDEgPSBmb29kXG4gICAgMiA9IHBsYXllclxuICAgIDMgPSB2aXJ1c1xuLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuU2VydmVyIHRvIGNsaWVudCBibG9iIGJsb2IgdXBkYXRlc1xuICAgIFRoaXJkIGJ5dGUgb2YgbWVzc2FnZTogLy8xMVxuICAgIHgsIHksIGRYLCBkWSwgY29sb3IsIHJhZGl1cywgbWFzc1xuLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuU2VydmVyIHRvIGNsaWVudCBibG9iIGZvb2QgdXBkYXRlc1xuICAgIFRoaXJkIGJ5dGUgb2YgbWVzc2FnZTpcbiAgICB4LCB5XG4tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5TZXJ2ZXIgdG8gY2xpZW50IGJsb2IgcGxheWVyIHVwZGF0ZXNcbiAgICBUaGlyZCBieXRlIG9mIG1lc3NhZ2U6XG4gICAgeCwgeSwgZFgsIGRZLCBjb2xvciwgcmFkaXVzLCBtYXNzLCBuYW1lXG4tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5TZXJ2ZXIgdG8gY2xpZW50IGJsb2IgdmlydXMgdXBkYXRlc1xuICAgIFRoaXJkIGJ5dGUgb2YgbWVzc2FnZTpcbiAgICB4LCB5LCByYWRpdXNcbi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbkNsaWVudCB0byBzZXJ2ZXIgdXBkYXRlc1xuICAgIEZpcnN0IGJ5dGUgb2YgbWVzc2FnZTpcbiAgICAwID0gTW92ZSBkaXJlY3Rpb24gdXBkYXRlXG4gICAgMSA9IEVqZWN0IG1hc3MgdXBkYXRlXG4gICAgMiA9IFNwbGl0IHVwZGF0ZVxuLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuQ2xpZW50IHRvIHNlcnZlciBtb3ZlIGRpcmVjdGlvbiB1cGRhdGVcbiAgICBTZWNvbmQgYnl0ZSBvZiBtZXNzYWdlOlxuICAgIGRpcmVjdGlvbiB4IHlcbi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuKi9cblxuZXhwb3J0IGNvbnN0IGZvb2RVcGRhdGUgPSAoc29ja2V0OiB3cywgZm9vZHM6IEZvb2RbXSk6IHZvaWQgPT4ge1xuICAgIGNvbnN0IG1lc3NhZ2UgPSBuZXcgQXJyYXlCdWZmZXIoZm9vZHMubGVuZ3RoKjQpO1xuICAgIGNvbnN0IGR2ID0gbmV3IERhdGFWaWV3KG1lc3NhZ2UpO1xuXG4gICAgZm9yKGxldCBpID0gMDsgaSA8IGZvb2RzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGZvb2QgPSBmb29kc1tpXTtcblxuICAgICAgICBjb25zb2xlLmxvZyhmb29kLnBvcy54LCBmb29kLnBvcy55KTtcblxuICAgICAgICBkdi5zZXRVaW50MTYoaSo0LCBmb29kLnBvcy54KTtcbiAgICAgICAgZHYuc2V0VWludDE2KGkqNCArIDIsIGZvb2QucG9zLnkpO1xuICAgIH1cblxuICAgIHNvY2tldC5zZW5kKG1lc3NhZ2UpO1xufVxuXG5leHBvcnQgY29uc3QgYmxvYlVwZGF0ZSA9IChzb2NrZXQ6IHdzLCBibG9iczogQmxvYltdKTogdm9pZCA9PiB7XG4gICAgY29uc3QgbWVzc2FnZSA9IG5ldyBBcnJheUJ1ZmZlcihibG9icy5sZW5ndGgqMTUpO1xuICAgIGNvbnN0IGR2ID0gbmV3IERhdGFWaWV3KG1lc3NhZ2UpO1xuXG4gICAgZm9yKGxldCBpID0gMDsgaSA8IGJsb2JzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGJsb2IgPSBibG9ic1tpXTtcblxuICAgICAgICBkdi5zZXRVaW50MTYoaSoxNSwgYmxvYi5wb3MueCk7XG4gICAgICAgIGR2LnNldFVpbnQxNihpKjE1ICsgMiwgYmxvYi5wb3MueSk7XG5cbiAgICAgICAgZHYuc2V0VWludDE2KGkqMTUgKyA0LCBibG9iLnZlbG9jaXR5LngpO1xuICAgICAgICBkdi5zZXRVaW50MTYoaSoxNSArIDYsIGJsb2IudmVsb2NpdHkueSk7XG5cbiAgICAgICAgZHYuc2V0VWludDgoaSoxNSArIDgsIGJsb2IuY29sb3Iucik7XG4gICAgICAgIGR2LnNldFVpbnQ4KGkqMTUgKyA5LCBibG9iLmNvbG9yLmcpO1xuICAgICAgICBkdi5zZXRVaW50OChpKjE1ICsgMTAsIGJsb2IuY29sb3IuYik7XG5cbiAgICAgICAgZHYuc2V0VWludDE2KGkqMTUgKyAxMSwgYmxvYi5yYWRpdXMpO1xuICAgICAgICBkdi5zZXRVaW50MTYoaSoxNSArIDEzLCBibG9iLm1hc3MpO1xuICAgIH1cblxuICAgIHNvY2tldC5zZW5kKG1lc3NhZ2UpO1xufVxuXG5leHBvcnQgY29uc3QgcGxheWVyVXBkYXRlID0gKHNvY2tldDogd3MsIHBsYXllcnM6IFBsYXllcltdLCBpc1NlbGY6IGJvb2xlYW4gPSBmYWxzZSk6IHZvaWQgPT4ge1xuICAgIGNvbnN0IG1lc3NhZ2UgPSBuZXcgQXJyYXlCdWZmZXIocGxheWVycy5sZW5ndGgqMTYpO1xuICAgIGNvbnN0IGR2ID0gbmV3IERhdGFWaWV3KG1lc3NhZ2UpO1xuXG4gICAgZm9yKGxldCBpID0gMDsgaSA8IHBsYXllcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgcGxheWVyID0gcGxheWVyc1tpXTtcblxuICAgICAgICBkdi5zZXRVaW50MTYoaSoxNiwgcGxheWVyLnBvcy54KTtcbiAgICAgICAgZHYuc2V0VWludDE2KGkqMTYgKyAyLCBwbGF5ZXIucG9zLnkpO1xuXG4gICAgICAgIGR2LnNldFVpbnQxNihpKjE2ICsgNCwgcGxheWVyLnZlbG9jaXR5LngpO1xuICAgICAgICBkdi5zZXRVaW50MTYoaSoxNiArIDYsIHBsYXllci52ZWxvY2l0eS55KTtcblxuICAgICAgICBkdi5zZXRVaW50OChpKjE2ICsgOCwgMjU1KTtcbiAgICAgICAgZHYuc2V0VWludDgoaSoxNiArIDksIDApO1xuICAgICAgICBkdi5zZXRVaW50OChpKjE2ICsgMTAsIDApO1xuXG4gICAgICAgIGR2LnNldFVpbnQxNihpKjE2ICsgMTEsIHBsYXllci5yYWRpdXMpO1xuICAgICAgICBkdi5zZXRVaW50MTYoaSoxNiArIDEzLCBwbGF5ZXIubWFzcyk7XG5cbiAgICAgICAgZHYuc2V0VWludDgoaSoxNiArIDE1LCAoaXNTZWxmID8gMSA6IDApKTtcbiAgICB9XG5cbiAgICBzb2NrZXQuc2VuZChtZXNzYWdlKTtcbn0iXX0=